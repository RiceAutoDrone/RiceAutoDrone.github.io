<!doctype html>
<html lang="en-US"><head>
   <meta charset="utf-8">
    <!-- Chulapa Jekyll Theme - v1.0.1.dev -->
    <!--  MIT License-->
    <!-- Docs: https://dieghernan.github.io/chulapa -->
    <!-- Repo: https://github.com/dieghernan/chulapa -->
    <!-- Page build 2023-03-28 15:07:47 -0500 -->
    <!--Google Structured Data-->
    <script type="application/ld+json">
        {
      "@context": "https://schema.org",
	  "@type": "Article",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:4000/raspberrypi_settings/01-access-point"
      },
      "headline": "Access Point",
      "image": "https://github.com/RiceAutoDrone.png",
      "datePublished": "2023-03-28T15:07:47-05:00",
      "dateModified": "2023-03-28T15:07:47-05:00",
      "author": {
        "@type": "Person",
        "name": "Yu Che Lin"
      },
       "publisher": {
        "@type": "Organization",
        "name": "Yu Che Lin",
        "url": "http://localhost:4000/",
        "logo": {
          "@type": "ImageObject",
          "url": "https://github.com/RiceAutoDrone.png"
        }
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "http://localhost:4000/"
      },{
        "@type": "ListItem",
        "position": 2,
        "name": "Access Point"
      }]
    }
    </script>
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "name": "Access Point",
    "description": "Set Access Point for ssh connection - Access Point Settings"
    }
}
</script><script type="application/ld+json">
{
  "@context" : "https://schema.org",
  "@type" : "Person",
  "homeLocation": {
    "@type": "Place",
    "name": "Houston, TX, US"
    },
  "description": "Publisher",
  "name" : "Yu Che Lin",
  "url" : "http://localhost:4000/"
}
</script>
   <title>Access Point | Rice Autodrone</title>
  <link rel="canonical" href="http://localhost:4000/raspberrypi_settings/01-access-point">
    <!-- Atom feed -->
  <link href="http://localhost:4000/atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed Rice Autodrone" >
    <!-- RSS 2.0 feed -->
  <link href="http://localhost:4000/rss.xml" type="application/rss+xml" rel="alternate" title="RSS 2.0 feed Rice Autodrone" >
    <!-- Meta tags -->
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   <meta name="author" content="Yu Che Lin" >
   <meta name="copyright" content="Yu Che Lin" >
   <meta name="description" content="Set Access Point for ssh connection - Access Point Settings">
   <meta name="thumbnail" content="https://github.com/RiceAutoDrone.png" >
   <meta name="robots" content="index, follow"><meta name="keywords" content="">
    <!-- OpenGraph -->
   <meta property="og:title" content="Access Point | Rice Autodrone" >
   <meta property="og:site_name" content="Rice Autodrone | A MECE Capstone Project" >
   <meta property="og:url" content="http://localhost:4000/raspberrypi_settings/01-access-point" >
   <meta property="og:type" content="website" >
   <meta property="og:description" content="Set Access Point for ssh connection - Access Point Settings" >
   <meta property="og:locale" content="en-US" >
   <meta property="og:image" content="https://github.com/RiceAutoDrone.png" >
    <!-- Twitter Cards -->
   <meta name="twitter:card" content="summary_large_image"><!-- start custom head snippets -->
<!-- this script is inserted before the css stylesheet -->
<!-- end custom head snippets -->
<!-- CSS -->
    <!-- Preconnect with Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"> 
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Fontawesome-->
    <!-- v6 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css">
  <link rel="preload" href="https://cdn.jsdelivr.net/gh/dieghernan/chulapa@master/assets/js/chulapa_script.js" as="script" >
  <link rel="preload" href="https://cdn.jsdelivr.net/gh/dieghernan/chulapa@master/assets/fonts/Chulapa/Chulapa-Bold_vmod.otf" as="font" type="font/otf" crossorigin>
    <!-- Theme css (Bootstrap included) -->
  <link rel="stylesheet" id="maincss" href="http://localhost:4000/assets/css/main.css" >
    <!-- Highlighter -->
  <link id="csshigh" rel="stylesheet" href="http://localhost:4000/assets/css/highlighter.css" >
    <!-- Custom css -->
  <link rel="stylesheet" href="http://localhost:4000/assets/css/custom.css" >
      <!-- start custom head snippets -->
<!-- insert favicons. use https://realfavicongenerator.net/ -->
<!-- end custom head snippets -->
</head>
<body class="d-flex flex-column h-entry" id="body">
	<a class="u-url d-none" href="http://localhost:4000/raspberrypi_settings/01-access-point">Invisible link to canonical for Microformats</a>
	<div class="navbar-chulapa-fab">
		<input type="checkbox" class="navbar-chulapa-fab-button d-none" id="navi-toggle">
		<label for="navi-toggle" class="navbar-toggler p-1 m-0 text-center d-flex">
			<span class="navbar-toggler-icon m-auto">&nbsp;</span>
		</label>
		<div class="navbar-chulapa-fab-background">&nbsp;</div>
		<nav class="navbar-chulapa-fab-nav" aria-label="primary-navigation">
			<ul class="navbar-nav text-center text-uppercase font-weight-light mt-0 mb-1 py-1">
				<li class="nav-item">
					<a class="nav-link px-3 navbar-brand mx-1 " href="http://localhost:4000/">Home</a>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1" href="http://localhost:4000/blog/">Blog</a>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1" href="http://localhost:4000/flight_controller_settings">Flight Controller Settings</a>
				</li><li class="nav-item dropdown my-0 py-1"><a class="nav-link dropdown-toggle px-3 py-1  active font-weight-bold " href="#" id="Raspberry-Pi-Settings" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Raspberry Pi Settings</a>
					<div class="dropdown-menu dropdown-menu-right text-center rounded-0 pr-4" aria-labelledby="Raspberry-Pi-Settings"><a class="dropdown-item nav-link d-block px-3 small " href="http://localhost:4000/raspberrypi_settings">Index </a><a class="dropdown-item nav-link d-block px-3 small  active font-weight-bold " href="http://localhost:4000/raspberrypi_settings/01-access-point">Access Point <span class="sr-only">(current)</span></a><a class="dropdown-item nav-link d-block px-3 small " href="http://localhost:4000/raspberrypi_settings/02-mavproxy">Mavproxy </a><a class="dropdown-item nav-link d-block px-3 small " href="http://localhost:4000/raspberrypi_settings/03-git">Git </a><a class="dropdown-item nav-link d-block px-3 small " href="http://localhost:4000/raspberrypi_settings/04-dronekit">Dronkit </a></div>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1" href="http://localhost:4000/jetson_settings">Jetson Settings</a>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1" href="http://localhost:4000/hardware">Hardware</a>
				</li><li class="nav-item dropdown my-0 py-1"><a class="nav-link dropdown-toggle px-3 py-1 " href="#" id="About" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">About</a>
					<div class="dropdown-menu dropdown-menu-right text-center rounded-0 pr-4" aria-labelledby="About"><a class="dropdown-item nav-link d-block px-3 small " href="http://localhost:4000/license">License </a></div>
				</li><li class="nav-item my-0 py-1">
					<a class="nav-link px-3 py-1 " href="http://localhost:4000/search">Search</a>
				</li></ul>
		</nav>
	</div>	<header class="d-flex align-items-center hero-chulapa"><div class="container-lg py-4">
   <h1 class="p-name">Access Point</h1><hr class="my-3">
   <p class="chulapa-subtitle p-summary">Set Access Point for ssh connection</p>
 </div>
</header>
	<main class="container-lg pb-3 flex-fill">
		<div class="row pt-2">
			<aside class="col-lg-2 mt-lg-3 small"></aside>
			<article id="maincontent" class="col-lg-8 mt-3 e-content">
            <nav aria-label="table-of-contents">
			<ul class="chulapa-toc-wrapper list-group mb-5 mx-3 mx-lg-5" id="toc"><li class="list-group-item font-weight-bold py-1 pr-0 mr-0 chulapa-toc-reset"><a href="#reference">Reference</a></li><li class="list-group-item font-weight-bold py-1 pr-0 mr-0 chulapa-toc-reset"><a href="#1-install-ap-and-management-software">1. Install AP and Management Software</a></li><li class="list-group-item font-weight-bold py-1 pr-0 mr-0 chulapa-toc-reset"><a href="#2set-up-the-network-router">2.Set up the Network Router</a></li><li class="list-group-item font-weight-bold py-1 pr-0 mr-0 chulapa-toc-reset"><a href="#3-ensure-wireless-operation">3. Ensure Wireless Operation</a></li><li class="list-group-item font-weight-bold py-1 pr-0 mr-0 chulapa-toc-reset"><a href="#4-configure-the-ap-software">4. Configure the AP Software</a></li><li class="list-group-item font-weight-bold py-1 pr-0 mr-0 chulapa-toc-reset"><a href="#5-running-the-new-wireless-ap">5. Running the new Wireless AP</a></li><li class="list-group-item font-weight-bold py-1 pr-0 mr-0 chulapa-toc-reset"><a href="#6-checkpoint">6. Checkpoint</a></li></ul>
			</nav>
			 <h2 id="reference">Reference</h2>
<p><a href="https://www.raspberrypi.com/documentation/computers/configuration.html#setting-up-a-routed-wireless-access-point">https://www.raspberrypi.com/documentation/computers/configuration.html#setting-up-a-routed-wireless-access-point</a></p>
<h2 id="1-install-ap-and-management-software">1. Install AP and Management Software</h2>
<p>In order to work as an access point, the Raspberry Pi needs to have the hostapd access point software package installed:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install hostapd
</code></pre></div></div>
<p>Enable the wireless access point service and set it to start when your Raspberry Pi boots:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl unmask hostapd
sudo systemctl enable hostapd
</code></pre></div></div>
<p>In order to provide network management services (DNS, DHCP) to wireless clients, the Raspberry Pi needs to have the dnsmasq software package installed:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install dnsmasq
</code></pre></div></div>
<p>Finally, install netfilter-persistent and its plugin iptables-persistent. This utility helps by saving firewall rules and restoring them when the Raspberry Pi boots:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo DEBIAN_FRONTEND=noninteractive apt install -y netfilter-persistent iptables-persistent
</code></pre></div></div>
<p>Software installation is complete. We will configure the software packages later on.</p>
<h2 id="2set-up-the-network-router">2.Set up the Network Router</h2>
<p>The Raspberry Pi will run and manage a standalone wireless network. It will also route between the wireless and Ethernet networks, providing internet access to wireless clients. If you prefer, you can choose to skip the routing by skipping the section “Enable routing and IP masquerading” below, and run the wireless network in complete isolation.</p>
<p>Define the Wireless Interface IP Configuration
The Raspberry Pi runs a DHCP server for the wireless network; this requires static IP configuration for the wireless interface (wlan0) in the Raspberry Pi. The Raspberry Pi also acts as the router on the wireless network, and as is customary, we will give it the first IP address in the network: 192.168.4.1.</p>
<p>To configure the static IP address, edit the configuration file for dhcpcd with:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo nano /etc/dhcpcd.conf
</code></pre></div></div>
<p>Go to the end of the file and add the following:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>interface wlan0
static ip_address=192.168.4.1/24
nohook wpa_supplicant
</code></pre></div></div>
<p>Enable Routing and IP Masquerading
This section configures the Raspberry Pi to let wireless clients access computers on the main (Ethernet) network, and from there the internet.</p>
<p>NOTE
If you wish to block wireless clients from accessing the Ethernet network and the internet, skip this section.
To enable routing, i.e. to allow traffic to flow from one network to the other in the Raspberry Pi, create a file using the following command, with the contents below:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo nano /etc/sysctl.d/routed-ap.conf
</code></pre></div></div>
<p>File contents:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Enable IPv4 routing
net.ipv4.ip_forward=1
</code></pre></div></div>
<p>Enabling routing will allow hosts from network 192.168.4.0/24 to reach the LAN and the main router towards the internet. In order to allow traffic between clients on this foreign wireless network and the internet without changing the configuration of the main router, the Raspberry Pi can substitute the IP address of wireless clients with its own IP address on the LAN using a “masquerade” firewall rule.</p>
<p>The main router will see all outgoing traffic from wireless clients as coming from the Raspberry Pi, allowing communication with the internet.</p>
<p>The Raspberry Pi will receive all incoming traffic, substitute the IP addresses back, and forward traffic to the original wireless client.</p>
<p>This process is configured by adding a single firewall rule in the Raspberry Pi:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
</code></pre></div></div>
<p>Now save the current firewall rules for IPv4 (including the rule above) and IPv6 to be loaded at boot by the netfilter-persistent service:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo netfilter-persistent save
</code></pre></div></div>
<p>Filtering rules are saved to the directory /etc/iptables/. If in the future you change the configuration of your firewall, make sure to save the configuration before rebooting.</p>
<p>Configure the DHCP and DNS services for the wireless network
The DHCP and DNS services are provided by dnsmasq. The default configuration file serves as a template for all possible configuration options, whereas we only need a few. It is easier to start from an empty file.</p>
<p>Rename the default configuration file and edit a new one:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.orig
sudo nano /etc/dnsmasq.conf
</code></pre></div></div>
<p>Add the following to the file and save it:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>interface=wlan0 # Listening interface
dhcp-range=192.168.4.2,192.168.4.20,255.255.255.0,24h
                # Pool of IP addresses served via DHCP
domain=wlan     # Local wireless DNS domain
address=/gw.wlan/192.168.4.1
                # Alias for this router
</code></pre></div></div>
<p>The Raspberry Pi will deliver IP addresses between 192.168.4.2 and 192.168.4.20, with a lease time of 24 hours, to wireless DHCP clients. You should be able to reach the Raspberry Pi under the name gw.wlan from wireless clients.</p>
<p>NOTE
There are three IP address blocks set aside for private networks. There is a Class A block from 10.0.0.0 to 10.255.255.255, a Class B block from 172.16.0.0 to 172.31.255.255, and probably the most frequently used, a Class C block from 192.168.0.0 to 192.168.255.255.
There are many more options for dnsmasq; see the default configuration file (/etc/dnsmasq.conf) or the online documentation for details.</p>
<h2 id="3-ensure-wireless-operation">3. Ensure Wireless Operation</h2>
<p>Countries around the world regulate the use of telecommunication radio frequency bands to ensure interference-free operation. The Linux OS helps users comply with these rules by allowing applications to be configured with a two-letter “WiFi country code”, e.g. US for a computer used in the United States.</p>
<p>In the Raspberry Pi OS, 5 GHz wireless networking is disabled until a WiFi country code has been configured by the user, usually as part of the initial installation process (see wireless configuration pages in this section for details.)</p>
<p>To ensure WiFi radio is not blocked on your Raspberry Pi, execute the following command:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo rfkill unblock wlan
</code></pre></div></div>
<p>This setting will be automatically restored at boot time. We will define an appropriate country code in the access point software configuration, next.</p>
<h2 id="4-configure-the-ap-software">4. Configure the AP Software</h2>
<p>Create the hostapd configuration file, located at /etc/hostapd/hostapd.conf, to add the various parameters for your new wireless network.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo nano /etc/hostapd/hostapd.conf
</code></pre></div></div>
<p>Add the information below to the configuration file. This configuration assumes we are using channel 7, with a network name of Autodrone, and a password autodrone1948. Note that the name and password should not have quotes around them. The passphrase should be between 8 and 64 characters in length.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>country_code=GB
interface=wlan0
ssid=Autodrone
hw_mode=g
channel=7
macaddr_acl=0
auth_algs=1
ignore_broadcast_ssid=0
wpa=2
wpa_passphrase=autodrone1948
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP
rsn_pairwise=CCMP
</code></pre></div></div>
<p>Note the line country_code=GB: it configures the computer to use the correct wireless frequencies in the United Kingdom. Adapt this line and specify the two-letter ISO code of your country. See Wikipedia for a list of two-letter ISO 3166-1 country codes.</p>
<p>To use the 5 GHz band, you can change the operations mode from hw_mode=g to hw_mode=a. Possible values for hw_mode are:</p>
<p>a = IEEE 802.11a (5 GHz) (Raspberry Pi 3B+ onwards)</p>
<p>b = IEEE 802.11b (2.4 GHz)</p>
<p>g = IEEE 802.11g (2.4 GHz)</p>
<p>Note that when changing the hw_mode, you may need to also change the channel - see Wikipedia for a list of allowed combinations.</p>
<h2 id="5-running-the-new-wireless-ap">5. Running the new Wireless AP</h2>
<p>Now restart your Raspberry Pi and verify that the wireless access point becomes automatically available.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl reboot
</code></pre></div></div>
<p>Once your Raspberry Pi has restarted, search for wireless networks with your wireless client. The network SSID you specified in file /etc/hostapd/hostapd.conf should now be present, and it should be accessible with the specified password.</p>
<p>If SSH is enabled on the Raspberry Pi, it should be possible to connect to it from your wireless client as follows, assuming the pi account is present: ssh pi@192.168.4.1 or ssh pi@gw.wlan</p>
<p>If your wireless client has access to your Raspberry Pi (and the internet, if you set up routing), congratulations on setting up your new access point!</p>
<p>If you encounter difficulties, contact the forums for assistance. Please refer to this page in your message.</p>
<h2 id="6-checkpoint">6. Checkpoint</h2>
<ul>
 <li><a href="">Image</a></li>
</ul>
			</article>
		</div>
	</main><nav aria-label="Navigation" class="container-lg chulapa-pagination  ">
 <ul class="col-lg-8 offset-lg-2 pagination chulapa-pagination-round px-0 ">
   <li class="page-item text-left mr-0 invisible">
      <a class="page-link border-0 px-4" href="#" tabindex="-1">
	  <i class="fa fa-chevron-left" aria-hidden="true"></i><span class="sr-only">Previous</span>
	  </a>
   </li>
   <li class="page-item border-0 disabled text-left ml-0 mr-auto d-none d-md-inline invisible">
     <p class="page-link chulapa-label"></p>
   </li>
   <li class="page-item border-0 disabled text-left ml-0 mr-auto d-none d-sm-inline d-md-none invisible">
     <p class="page-link chulapa-label"></p>
   </li>
	 <li class="page-item disabled mx-auto invisible">
	  <p class="page-link">|</p>
	 </li>	
	 <li class="page-item border-0 disabled text-right mr-0 ml-auto d-none d-sm-inline d-md-none ">
	   <p class="page-link chulapa-label">MavProxy Settings</p>
	 </li>
	 <li class="page-item border-0 disabled text-right mr-0 ml-auto d-none d-md-inline ">
	   <p class="page-link chulapa-label">MavProxy Settings</p>
	 </li>
   <li class="page-item text-right ml-0 ">
      <a class="page-link border-0 px-4" href="http://localhost:4000/raspberrypi_settings/02-mavproxy">
	  <i class="fa fa-chevron-right" aria-hidden="true"></i><span class="sr-only">Next</span></a>
   </li>
 </ul>
</nav>
<!-- Footer -->
 <footer class="footer-chulapa text-center mt-0 pt-3">
   <div class="container">
     <div class="row">
       <div class="col-xl-10 offset-xl-1"><div role="navigation" class="d-flex flex-wrap justify-content-center"><a href="https://github.com/RiceAutoDrone/RiceAutoDrone.github.io.git" title="footerRepo on Github" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">Repo on Github</span>
            </a><a href="http://localhost:4000/atom.xml" title="footerRSS" class="chulapa-footer-sociallink lead"><span class="fa-stack fa-lg" aria-hidden="true">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span><span class="sr-only">RSS</span>
            </a></div><p class="mt-2 mb-3">&copy; 2023 Yu Che Lin</p>
          <!-- Do not remove this in order to give  attributions -->
         <p class="chulapa-footer-brand">Powered by <a href="https://dieghernan.github.io/chulapa"> <span class="chulapa">Chulapa</span> Jekyll Theme</a><br><b>GitDev</b> skin by <a href="https://github.com/dieghernan">dieghernan</a></p>
          <!-- End  attributions -->
       </div>
     </div>
 </div>
</footer>
<!-- Footer -->
<!-- JS, Popper.js, and jQuery -->
	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/gh/dieghernan/chulapa@master/assets/js/chulapa_script.js"></script>
	<!-- start custom scripts to be placed at the bottom of the page -->
<!-- end custom bottom scripts -->
	</body>
</html>
